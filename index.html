<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Dubai Road Map</title>
    <link rel="icon" type="image/x-icon" href="https://wallpapers.com/images/hd/exceptional-dubai-z03qow0d0d3yuumg.jpg">
    <style>
        /* Import Google Font 'Inter' */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');

        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
            /* Changed background to pure white */
            background-color: #ffffff;
            min-height: 100vh; /* Ensure full viewport height */
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
        }

        /* Navigation Bar Styling */
        .navbar {
            width: 100%;
            /* Updated background color and shadow */
            background-color: #222d43;
            padding: 14px 20px;
            box-shadow: 0 6px 18px rgba(18,28,75,0.09);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            z-index: 100;
            position: relative; /* Added for better z-indexing */
            box-sizing: border-box;
        }
        .nav-buttons {
            display: flex;
            gap: 17px; /* Updated gap */
        }
        .nav-button {
            /* Updated button styles */
            background: linear-gradient(90deg,#48c6ef 0%,#6f86d6 80%);
            color: #fff;
            padding: 10px 24px;
            border: none;
            border-radius: 2em; /* More rounded */
            cursor: pointer;
            font-size: 1.05rem; /* Slightly larger */
            font-weight: 700; /* Bolder */
            letter-spacing: 0.02em;
            margin: 0 1px;
            transition: background 0.18s, transform 0.16s, box-shadow 0.18s;
            box-shadow: 0 2px 8px rgba(48,198,239,0.11);
            outline: none;
        }
        .nav-button:hover, .nav-button:focus {
            /* Updated hover/focus styles */
            background: linear-gradient(90deg,#72efdd 0%,#48c6ef 100%);
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 4px 18px rgba(32,186,201,0.19);
        }

        /* Back to Top Button */
        #back-to-top {
            position: fixed;
            bottom: 24px;
            right: 24px;
            display: none; /* Hidden by default, shown via JS */
            background: linear-gradient(90deg,#2ecc71 20%,#3498db 90%);
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 49px;
            height: 49px;
            font-size: 2rem;
            cursor: pointer;
            z-index: 1500;
            box-shadow: 0 2px 16px #31997c44;
            transition: background 0.19s, transform 0.16s;
        }
        #back-to-top:hover {
            background: linear-gradient(90deg,#3498db 0%,#2ecc71 100%);
            transform: scale(1.09);
        }

        /* Page Container Styling */
        .page-container {
            width: 100%;
            flex-grow: 1;
            background-color: #fff; /* This ensures the content area remains white */
            box-sizing: border-box;
            /* Removed overflow-y: auto; to allow window scrolling */
            display: none;
            transition: opacity 0.5s; /* Smooth transition for page changes */
            min-height: 90vh; /* Ensure pages take up most of the height */
            flex-direction: column;
            align-items: center;
        }
        .page-container.active-page {
            display: flex; /* Changed to flex for better content control */
            opacity: 1;
            animation: fadeIn 0.9s; /* Fade in animation */
        }
        @keyframes fadeIn {
            from { opacity: 0.2; transform: translateY(25px);}
            to { opacity: 1; transform: none;}
        }
        .blurred-content {
            filter: blur(5px);
            pointer-events: none;
        }

        /* HERO BANNER */
        .hero-banner {
            width: 100%;
            position: relative;
            border-radius: 1.2rem;
            box-shadow: 0 8px 32px rgba(44, 62, 80, 0.09);
            overflow: hidden;
            max-width: 1100px;
            margin-bottom: 32px;
            animation: fadeIn 1.2s;
        }
        .hero-banner img {
            width: 100%;
            min-height: 260px;
            max-height: 410px;
            object-fit: cover;
            filter: brightness(0.72);
        }
        .hero-text {
            position: absolute;
            left: 65px; top: 50%;
            transform: translateY(-50%);
            color: #fff;
            text-shadow: 0 5px 30px #0009, 0 1px 0 #222a;
        }
        .hero-text h1 {
            font-size: 3.4rem;
            font-weight: 800;
            letter-spacing: 1.5px;
            margin-bottom: 14px;
            line-height: 1.05;
            text-shadow: 0 0.5px 6px #0003;
        }
        .hero-text p {
            font-size: 1.42rem;
            line-height: 1.25;
            margin-top: 12px;
            letter-spacing: 0.04em;
            color: #ffffffee;
        }

        /* Quick Links Cards below HERO */
        .quick-links {
            display: flex;
            gap: 23px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 46px;
        }
        .quick-card {
            border: none;
            border-radius: 1.1rem;
            background: linear-gradient(135deg,#48c6ef 0%,#38ef7d 100%);
            color: #fff;
            box-shadow: 0 3px 14px rgba(76,201,240,0.13);
            padding: 20px 34px 22px 28px;
            text-align: left;
            width: 256px; min-width:173px;
            font-size: 1.11rem;
            font-family: inherit;
            cursor: pointer;
            outline: none;
            transition: transform 0.14s, box-shadow 0.23s, background 0.25s;
            margin: 0 4px 10px 4px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: flex-start;
        }
        .quick-card span.emoji {
            font-size: 2.25rem;
            margin-bottom: 3px; line-height: 1;
        }
        .quick-card strong {
            font-size: 1.24rem;
            letter-spacing:0.01em;
        }
        .quick-card:hover {
            transform: translateY(-6px) scale(1.04);
            box-shadow: 0 10px 44px rgba(38,205,199,0.17);
            background: linear-gradient(135deg,#72efdd 13%,#48c6ef 100%);
        }
        /* "Did You Know?" Bubble */
        .did-you-know {
            background: linear-gradient(100deg, #fff4b4 60%, #27aedbab 120%);
            border-left: 7px solid #6699f8;
            color: #285b4e;
            font-weight: 600;
            padding: 20px 24px;
            margin: 24px auto 0 auto;
            font-size: 1.2rem;
            border-radius: 1.3em;
            max-width: 640px;
            box-shadow: 0 8px 48px #ffd60011;
            position: relative;
        }
        .did-you-know .emoji {
            font-size: 1.76em; position: absolute; left: 1.1em; top: 1em; opacity: 0.8;
        }

        /* Home Page Section Styling */
        #home-page {
            justify-content: flex-start;
            padding-top: 32px; /* Adjusted padding */
            min-height: 82vh; /* Adjusted minimum height */
            box-sizing: border-box;
        }
        #home-page h2 {
            font-size: 2.5rem; /* Adjusted font size */
            color: #226280; /* Updated color */
            margin-bottom: 17px; /* Adjusted margin */
            text-shadow: 0 2px 10px #82c8f866; /* Added text shadow */
        }
        #home-page p {
            font-size: 1.17rem; /* Adjusted font size */
            color: #426894; /* Updated color */
            margin-bottom: 16px; /* Adjusted margin */
            max-width: 740px; /* Adjusted max-width */
            line-height: 1.7; /* Adjusted line height */
            letter-spacing: 0.01em;
        }
        .home-section {
            width: 100%;
            max-width: 850px; /* Adjusted max-width */
            text-align: left;
            margin-bottom: 42px; /* Adjusted margin */
            padding: 22px 20px 20px 30px; /* Adjusted padding */
            background: linear-gradient(111deg,#e6faff 50%, #f8f8f8 100%); /* Updated background */
            border-radius: 1rem;
            box-shadow: 0 4px 13px rgba(52,152,219,0.06); /* Updated shadow */
        }
        .home-section h3 {
            font-size: 2rem;
            color: #1c4366; /* Updated color */
            margin-bottom: 15px;
            border-bottom: 2px solid #a2d9ce;
            padding-bottom: 9px; /* Adjusted padding */
            font-weight: 700; /* Bolder */
        }
        .home-section h4 {
            font-size: 1.17rem; /* Adjusted font size */
            color: #2ecc71;
            margin-top: 17px; /* Adjusted margin */
            margin-bottom: 7px; /* Adjusted margin */
            font-weight: 700; /* Bolder */
        }
        .home-section ul {
            list-style: none;
            padding: 0;
        }
        .home-section ul li {
            margin-bottom: 11px; /* Adjusted margin */
            color: #305871; /* Updated color */
            line-height: 1.56; /* Adjusted line height */
        }
        .home-section ul li strong {
            color: #2d5384; /* Updated color */
        }
        .home-buttons {
            margin-top: 29px; /* Adjusted margin */
        }
        .home-buttons .nav-button {
            font-size: 1.12rem; /* Adjusted font size */
            padding: 14px 28px; /* Adjusted padding */
        }

        /* Highways Page Styling */
        #highways-page {
            height: 100%;
            box-sizing: border-box;
        }
        #highways-page h1 {
            text-align: center;
            margin-bottom: 36px; /* Adjusted margin */
            color: #214764; /* Updated color */
            font-size: 2.42rem; /* Adjusted font size */
            font-weight: bold;
            text-shadow: 0 1px 8px #58c7f128; /* Added text shadow */
        }
        /* Search Bar */
        #location-search {
            width: 70%;
            padding: 11px 10px 11px 55px;
            margin: 7px auto 30px auto;
            display: block;
            font-size: 1.13rem;
            border-radius: 1.7em;
            border: 1.2px solid #8fd3f4;
            background: #fffefa url('https://wallpapers.com/images/hd/exceptional-dubai-z03qow0d0d3yuumg.jpg') no-repeat 15px center/30px 30px; /* Adjusted size and position */
            box-shadow: 0 2px 6px rgba(170,210,224,0.12);
            transition: border-color 0.19s;
        }
        #location-search:focus {
            outline: 0;
            border-color: #48c6ef;
        }
        .map {
            display: flex;
            flex-direction: column;
            gap: 42px; /* Adjusted gap */
            position: relative;
            width: 100%;
            max-width: 850px; /* Adjusted max-width */
        }
        .road {
            position: relative;
            background: linear-gradient(90deg,#e7faff 60%,#e8f5e9 100%); /* Updated background */
            padding: 24px 20px 15px 29px; /* Adjusted padding */
            border-radius: 1.13rem; /* Adjusted border-radius */
            box-shadow: 0 6px 12px #aac5ea12; /* Updated shadow */
            cursor: pointer;
            transition: background 0.19s, box-shadow 0.22s; /* Updated transition */
        }
        .road:hover {
            background: linear-gradient(90deg,#ccf2fa 60%,#d4edda 100%); /* Updated hover background */
            box-shadow: 0 11px 22px #8fd3f428; /* Updated hover shadow */
        }
        .road h2 {
            margin-bottom: 8px; /* Adjusted margin */
            color: #34495e;
            font-size: 2rem;
            font-weight: 700;
        }
        .road h2::before {
            content: "üõ£Ô∏è "; /* Added emoji */
            font-size: 1.17em;
            vertical-align: middle;
        }
        .dev-info {
            margin-bottom: 12px; /* Adjusted margin */
            font-size: 1rem; /* Adjusted font size */
            color: #7f8c8d;
        }
        .locations {
            display: none;
            flex-wrap: wrap;
            gap: 11px; /* Adjusted gap */
            position: relative;
            border-top: 3px solid #a2d9ce;
            padding-top: 16px; /* Adjusted padding */
        }
        .locations.is-visible {
            display: flex;
            animation: fadeIn 0.45s; /* Added fade in animation */
        }
        /* Location chips */
        .location {
            background-color: #21bfa4; /* Updated background color */
            color: #fff;
            padding: 9px 16px 9px 13px; /* Adjusted padding */
            border-radius: 1em; /* More rounded */
            cursor: pointer;
            font-size: 1.01rem; /* Adjusted font size */
            font-weight: 600;
            box-shadow: 0 2px 14px rgba(32,186,201,0.13); /* Updated shadow */
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 7px;
            transition: background 0.14s, box-shadow 0.14s, transform 0.18s; /* Updated transition */
            position: relative;
        }
        .location:hover,
        .location.active {
            background: linear-gradient(90deg,#48dedc 35%,#2ecc71 90%); /* Updated hover background */
            box-shadow: 0 6px 18px rgba(52,193,151,0.17); /* Updated hover shadow */
            color: #fff;
            transform: scale(1.04);
        }
        .location::before {
            content: "üìç"; /* Added emoji */
            font-size: 1.2em;
            margin-right: 2px;
            opacity: 0.7;
        }

        /* Info Panel Styling */
        .info-panel {
            position: fixed;
            top: 0;
            right: -100%;
            width: 360px; /* Adjusted width */
            max-width: 97vw; /* Adjusted max-width */
            height: 100%;
            background: rgba(0,0,0,0.68); /* Adjusted background opacity */
            display: flex;
            justify-content: flex-end;
            z-index: 1100; /* Adjusted z-index */
            transition: right 0.39s; /* Adjusted transition */
        }
        .info-panel.active {
            right: 0;
        }
        .panel-content {
            background: linear-gradient(135deg, #ffffff 60%, #e0f6f7 100%); /* Updated background */
            border-radius: 1.55rem 0 0 1.55rem; /* Adjusted border-radius */
            padding: 30px 28px 29px 26px; /* Adjusted padding */
            width: 100%;
            box-shadow: -5px 0 20px rgba(0, 0, 0, 0.33); /* Adjusted shadow */
            overflow-y: auto;
            position: relative;
            box-sizing: border-box;
            transform: translateX(100%);
            transition: transform 0.37s; /* Adjusted transition */
        }
        .info-panel.active .panel-content {
            transform: translateX(0);
        }

        .close {
            font-size: 31px; /* Adjusted font size */
            position: absolute;
            top: 13px; right: 23px; z-index:1200; /* Adjusted positioning and z-index */
            cursor: pointer;
            color: #48c6ef; /* Updated color */
            transition: color 0.15s;
            background: none; /* Removed background */
            border: none; /* Removed border */
            line-height: 1;
        }
        .close:hover { color: #2ecc71;} /* Updated hover color */
        #info-content {
            margin-top: 32px; /* Adjusted margin */
            font-size: 1.06rem; /* Adjusted font size */
        }
        #info-content h2 {
            font-size: 1.46rem; /* Adjusted font size */
            color: #158b81; /* Updated color */
            margin-bottom: 1rem;
            font-weight: 700; /* Bolder */
            text-shadow: 0 3px 20px #38ef7d11; /* Added text shadow */
        }
        #info-content h3 {
            font-size: 1.08rem; /* Adjusted font size */
            color: #4886f7; /* Updated color */
            margin-top: 1rem; /* Adjusted margin */
            margin-bottom: 0.4rem; /* Adjusted margin */
        }
        #info-content p {
            font-size: 1rem;
            color: #46637d; /* Updated color */
            line-height: 1.6;
            margin-bottom: 0.85rem; /* Adjusted margin */
        }
        .location-thumb {
            width: 99%;
            max-height: 120px;
            object-fit: cover;
            border-radius: 0.65em;
            margin-bottom: 1rem;
            box-shadow: 0 1px 9px #cce7f011;
            background: #f6faff center/cover;
        }
        .location-link {
            display: inline-block;
            margin-top: 6px;
            padding: 6px 14px;
            background: linear-gradient(90deg,#48c6ef 10%,#38ef7d 100%);
            color: #fff;
            font-weight: 600;
            border-radius: 0.8em;
            text-decoration: none;
            box-shadow: 0 2px 9px #68e1b421;
            transition: background 0.14s;
        }
        .location-link:hover { background: linear-gradient(90deg,#38ef7d 10%,#48c6ef 100%);}
        .info-icons span {
            font-size: 1.13em;
            margin-right: 7px;
            vertical-align: middle;
        }
        /* New styles for AI insights */
        .ai-insights-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px dashed #a2d9ce;
        }
        .ai-insights-section h3 {
            color: #1c4366;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }
        .ai-insights-section p {
            font-size: 0.95rem;
            color: #46637d;
            line-height: 1.5;
        }
        .generate-insights-btn {
            background: linear-gradient(90deg, #f39c12 0%, #e67e22 100%); /* Orange gradient */
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 0.75rem;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            margin-top: 15px;
            transition: background 0.3s ease-in-out, transform 0.2s ease-in-out;
            box-shadow: 0 3px 8px rgba(243, 156, 18, 0.3);
        }
        .generate-insights-btn:hover {
            background: linear-gradient(90deg, #e67e22 0%, #f39c12 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(243, 156, 18, 0.4);
        }
        .loading-message {
            margin-top: 10px;
            font-style: italic;
            color: #7f8c8d;
            font-size: 0.9rem;
        }


        /* Responsive adjustments */
        @media (max-width: 768px) {
            .navbar { flex-direction: column; gap: 10px; padding: 10px;}
            .nav-buttons { flex-direction: column; width: 100%; gap: 10px;}
            .nav-button { width: 95%; margin: 0 auto;}
            #home-page { padding-top:11px; }
            #home-page h2 { font-size:2rem; }
            #home-page p { font-size:1rem; }
            .home-section { padding:11px 7px; margin-bottom:23px;}
            .home-section h3 { font-size:1.17rem; }
            .home-section h4 { font-size:1rem; }
            .home-buttons .nav-button { font-size:1rem; padding:10px 18px;}
            #highways-page h1 { font-size:1.3rem; margin-bottom:11px;}
            .road { padding:10px 7px 6px 14px;}
            .road h2 { font-size:1rem;}
            .locations { gap: 3px;}
            .location { font-size:0.75rem; padding:5px 7px;}
            #info-content h2 { font-size:1.1rem;}
            #info-content h3 { font-size:1rem;}
            #info-content p { font-size:0.83rem;}
            .info-panel { width: 100vw; justify-content: center;}
            .panel-content {
                border-radius: 1.55rem 1.55rem 0 0;
                width: 100%;
                height: calc(90vh - 25px);
                position: absolute;
                bottom: 0;
                transform: translateY(100%);
            }
            .info-panel.active .panel-content { transform: translateY(0);}
            .close { top:15px; left:20px; right:auto;}
        }
    </style>
</head>
<body>
    <div class="navbar" aria-label="Main Navigation">
        <div class="nav-buttons">
            <button class="nav-button" onclick="showPage('home-page')" aria-label="Go to Home">üè† Home</button>
            <button class="nav-button" onclick="showPage('highways-page')" aria-label="Explore Dubai Highways">üõ£Ô∏è Highways</button>
        </div>
    </div>

    <button id="back-to-top" title="Back to Top" aria-label="Back to Top">‚¨ÜÔ∏è</button>

    <div class="page-container" id="home-page">
        <!-- Hero section -->
        <div class="hero-banner" style="margin-top:16px;">
            <img src="https://images.unsplash.com/photo-1464983953574-0892a716854b?auto=format&fit=crop&w=1200&q=80"
                alt="Dubai Skyline and Sheikh Zayed Road">
            <div class="hero-text">
                <h1>Dubai Real Estate Explorer</h1>
                <p>
                    Unfold the City of <b>Innovation</b>, <b>Luxury</b> & Opportunity.<br>
                    All about <strong style="color:#ffd600">Highways</strong>, <strong style="color:#00eaff">Developers</strong> & <strong style="color:#45ea57">Rules</strong>!
                </p>
            </div>
        </div>

        <!-- Quick links (cards) -->
        <div class="quick-links" aria-label="Quick Main Sections">
            <button class="quick-card" onclick="showPage('highways-page')">
                <span class="emoji">üó∫Ô∏è</span>
                <strong>Highways Map</strong>
                <span>Discover Dubai's main roads</span>
            </button>
            <button class="quick-card" onclick="scrollToSection('dev-entities')">
                <span class="emoji">üèóÔ∏è</span>
                <strong>Developers & Entities</strong>
                <span>Who builds Dubai?</span>
            </button>
            <button class="quick-card" onclick="scrollToSection('dld-forms')">
                <span class="emoji">üìë</span>
                <strong>DLD Forms Guide</strong>
                <span>Key real estate agreements</span>
            </button>
            <button class="quick-card" onclick="scrollToSection('rules-regs')">
                <span class="emoji">‚öñÔ∏è</span>
                <strong>Rules & Regulations</strong>
                <span>For agents & buyers</span>
            </button>
        </div>

        <!-- Did you know box -->
        <div class="did-you-know" id="did-you-know">
            <span id="didYouKnowText">
                Did you know? <b>Dubai Land Department (DLD)</b> was founded in <b>1960</b> and registers all property transactions in the emirate!
            </span>
        </div>

        <h2 style="margin-bottom:0;">Welcome to Dubai Real Estate Explorer</h2>
        <p>Your comprehensive guide to Dubai's dynamic real estate landscape, major highways, and key locations.</p>

        <div class="home-section" id="about-dubai">
            <h3>About Dubai</h3>
            <p>Dubai is a global city and business hub of the Middle East. It is also a major transport hub for passengers and cargo. Oil revenue helped accelerate the development of the city, but Dubai's economy is now built on tourism, trade, real estate, and financial services. It is known for its luxurious architecture, vibrant nightlife, and ambitious construction projects, offering a unique blend of traditional Arabian culture and modern cosmopolitan living.</p>
        </div>
        <div class="home-section" id="about-dld">
            <h3>About DLD (Dubai Land Department)</h3>
            <p>The Dubai Land Department (DLD) is the government entity responsible for regulating and promoting the real estate sector in Dubai. Established in 1960, DLD aims to create a transparent, fair, and efficient real estate market by providing various services, including property registration, dispute resolution, and issuing regulations. It ensures the rights of all parties involved in real estate transactions, fostering trust and investment in the emirate.</p>
            <p><strong>Managed by:</strong> Government of Dubai</p>
        </div>

        <div class="home-section" id="dev-entities">
            <h3>Key Government-Backed Developers & Entities</h3>
            <ul>
                <li>
                    <h4>Nakheel Properties</h4>
                    <p><strong>Description:</strong> A world-leading master developer, Nakheel is responsible for some of Dubai's most ambitious projects, including the Palm Jumeirah and The World Islands. It is a government-owned entity focusing on creating waterfront developments, residential communities, and retail destinations.</p>
                    <p><strong>Managed by:</strong> Government of Dubai</p>
                </li>
                <li>
                    <h4>Emaar Properties</h4>
                    <p><strong>Description:</strong> One of the largest and most prestigious real estate developers globally, known for iconic projects like the Burj Khalifa and The Dubai Mall. Emaar has significant government ownership (via the Investment Corporation of Dubai, ICD) and plays a pivotal role in shaping Dubai's urban landscape.</p>
                    <p><strong>Managed by:</strong> Significant government ownership/ties (via ICD)</p>
                </li>
                <li>
                    <h4>Dubai South</h4>
                    <p><strong>Description:</strong> A master-planned city encompassing Al Maktoum International Airport and the Expo 2020 site. Dubai South is a government-led initiative focused on aviation, logistics, commercial, and residential developments, aiming to become a global hub for trade and business.</p>
                    <p><strong>Managed by:</strong> Dubai Aviation City Corporation (Government of Dubai)</p>
                </li>
                <li>
                    <h4>wasl Properties</h4>
                    <p><strong>Description:</strong> A subsidiary of the Dubai Real Estate Corporation (DREC), wasl Properties is a prominent government-owned real estate management and development company. It manages a diverse portfolio of residential and commercial properties, contributing significantly to Dubai's rental market and urban development.</p>
                    <p><strong>Managed by:</strong> Dubai Real Estate Corporation (Government of Dubai)</p>
                </li>
            </ul>
        </div>

        <div class="home-section">
            <h3>Dubai Holding & Affiliated Real Estate Entities</h3>
            <p>Dubai Holding is a diversified global investment company with operations across various sectors, including real estate. It manages a broad portfolio of assets and plays a strategic role in Dubai's economic development. Below are key real estate entities either directly under Dubai Holding or closely affiliated/partnered in government-backed initiatives:</p>
            <ul>
                <li>
                    <h4>Dubai Properties (DP)</h4>
                    <p><strong>Description:</strong> A prominent real estate master developer under Dubai Holding, focusing on creating and managing leading residential and mixed-use communities across Dubai, such as Jumeirah Beach Residence (JBR) and Dubailand.</p>
                    <p><strong>Managed by:</strong> Dubai Holding (Direct Subsidiary)</p>
                </li>
                <li>
                    <h4>Meraas</h4>
                    <p><strong>Description:</strong> Now integrated into Dubai Holding, Meraas is known for developing innovative and vibrant lifestyle destinations, including City Walk, La Mer, and Bluewaters Island, enhancing Dubai's leisure, retail, and hospitality sectors.</p>
                    <p><strong>Managed by:</strong> Dubai Holding (Integrated Entity)</p>
                </li>
                <li>
                    <h4>TECOM Group</h4>
                    <p><strong>Description:</strong> While primarily managing business parks and free zones (like Dubai Media City, Dubai Internet City, Dubai Knowledge Park), TECOM Group, a member of Dubai Holding, also develops and manages significant commercial and some residential real estate within these clusters.</p>
                    <p><strong>Managed by:</strong> Dubai Holding (Direct Subsidiary)</p>
                </li>
                <li>
                    <h4>Jumeirah Group</h4>
                    <p><strong>Description:</strong> A global luxury hotel company and a member of Dubai Holding. Jumeirah Group develops and manages an iconic portfolio of hotels and resorts, including the Burj Al Arab, contributing to Dubai's luxury tourism and real estate landscape.</p>
                    <p><strong>Managed by:</strong> Dubai Holding (Direct Subsidiary)</p>
                </li>
                <li>
                    <h4>Nakheel Properties</h4>
                    <p><strong>Description:</strong> As mentioned, Nakheel is a major government-owned developer of landmark projects like the Palm Jumeirah. While not a direct subsidiary of Dubai Holding, it is a key government-backed entity whose strategic vision aligns with Dubai's overall development goals, often working in close coordination with other government-affiliated bodies.</p>
                    <p><strong>Managed by:</strong> Government of Dubai (Strategic Alignment with Dubai's Development Vision)</p>
                </li>
                <li>
                    <h4>Emaar Properties</h4>
                    <p><strong>Description:</strong> Emaar has significant government ownership via the Investment Corporation of Dubai (ICD). Although not a direct subsidiary of Dubai Holding, its operations and projects are deeply integrated into Dubai's strategic urban development plans, often collaborating on major government-backed initiatives.</p>
                    <p><strong>Managed by:</strong> Significant Government Ownership/Ties (Strategic Alignment)</p>
                </li>
                <li>
                    <h4>Union Properties</h4>
                    <p><strong>Description:</strong> A prominent publicly listed real estate developer in Dubai. **Please note:** While Union Properties is a major developer in Dubai's real estate market, it is a publicly traded company and is **not a government-owned entity or a subsidiary of Dubai Holding**. Its inclusion here is based on its significant presence within the broader Dubai real estate ecosystem.</p>
                    <p><strong>Managed by:</strong> Publicly Listed Company</p>
                </li>
            </ul>
        </div>


        <div class="home-section">
            <h3>Main Private Developers</h3>
            <ul>
                <li>
                    <h4>Damac Properties</h4>
                    <p><strong>Description:</strong> A leading luxury real estate developer in the Middle East, known for its high-end residential, commercial, and leisure properties. Damac often collaborates with luxury brands like Versace and Cavalli for branded residences, with notable projects including Damac Hills and Akoya Oxygen.</p>
                    <p><strong>Managed by:</strong> Hussain Sajwani (Chairman)</p>
                </li>
                <li>
                    <h4>Azizi Developments</h4>
                    <p><strong>Description:</strong> A prominent private developer with a focus on residential and commercial properties in prime locations across Dubai, including Al Furjan, Dubai Healthcare City, and Palm Jumeirah. Azizi is known for its diverse portfolio of apartments and community-centric living spaces.</p>
                    <p><strong>Managed by:</strong> Farhad Azizi (CEO)</p>
                </li>
                <li>
                    <h4>Binghatti Developers</h4>
                    <p><strong>Description:</strong> Gaining significant recognition for its distinctive architectural designs, particularly its "hyper-towers" with unique balcony structures. Binghatti focuses on residential projects, offering a mix of apartments and townhouses in various Dubai communities, often emphasizing modern living and striking aesthetics.</p>
                    <p><strong>Managed by:</strong> Muhammad Binghatti (CEO)</p>
                </li>
                <li>
                    <h4>Select Group</h4>
                    <p><strong>Description:</strong> A well-established real estate developer with a strong presence in Dubai Marina and Business Bay. Select Group is known for delivering high-quality residential and mixed-use projects, often focusing on waterfront living and premium amenities.</p>
                    <p><strong>Managed by:</strong> Rahail Aslam (CEO)</p>
                </li>
            </ul>
        </div>

        <div class="home-section" id="dld-forms">
            <h3>DLD Forms: Understanding Key Agreements</h3>
            <p>The Dubai Land Department (DLD) mandates specific forms to ensure transparency and legal clarity in real estate transactions. These forms are crucial for both buyers, sellers, and agents:</p>
            <ul>
                <li>
                    <h4>Form A (Seller's Agreement)</h4>
                    <p><strong>Purpose:</strong> This is an exclusive agreement between a property seller and a real estate agent. It grants the agent the exclusive right to market and sell the property for a specified period and price. It outlines the agent's commission, marketing strategy, and the seller's obligations.</p>
                    <p><strong>Managed by:</strong> RERA (Real Estate Regulatory Agency) via the DLD system.</p>
                </li>
                <li>
                    <h4>Form B (Buyer's Agreement)</h4>
                    <p><strong>Purpose:</strong> This is an agreement between a buyer and their real estate agent. It outlines the terms under which the agent will assist the buyer in finding and purchasing a property, including the agent's commission (if applicable to the buyer) and the buyer's requirements.</p>
                    <p><strong>Managed by:</strong> RERA via the DLD system.</p>
                </li>
                <li>
                    <h4>Form F (Memorandum of Understanding - MOU)</h4>
                    <p><strong>Purpose:</strong> This is a crucial agreement signed by the buyer, seller, and their respective agents (if any) once a deal has been agreed upon. It formalizes the terms of the sale, including the property details, price, payment schedule, handover date, and any special conditions. It acts as a pre-cursor to the final property transfer.</p>
                    <p><strong>Managed by:</strong> RERA via the DLD system.</p>
                </li>
                <li>
                    <h4>Other Important DLD Aspects:</h4>
                    <ul>
                        <li><strong>Ejari:</strong> Mandatory registration system for all tenancy contracts in Dubai, protecting the rights of landlords and tenants.</li>
                        <li><strong>Oqood:</strong> Initial registration of off-plan property sales contracts, ensuring buyer protection.</li>
                        <li><strong>Trust Accounts:</strong> DLD mandates that developers hold buyer payments in trust accounts to safeguard investments during off-plan construction.</li>
                        <li><strong>Valuation Services:</strong> DLD provides official property valuation services for various purposes.</li>
                    </ul>
                    <p><strong>Managed by:</strong> Dubai Land Department (DLD)</p>
                </li>
            </ul>
        </div>

        <div class="home-section">
            <h3>Taxes Incurred by the Government in Dubai Real Estate</h3>
            <p>While Dubai is known for its tax-friendly environment, there are specific government fees and charges associated with real estate transactions:</p>
            <ul>
                <li>
                    <h4>DLD Transfer Fee (4%)</h4>
                    <p><strong>Description:</strong> This is the most significant fee, typically 4% of the property's purchase price. It is usually paid by the buyer, although this can be negotiated between buyer and seller. It's a one-time fee paid upon property transfer.</p>
                    <p><strong>Managed by:</strong> Dubai Land Department (DLD)</p>
                </li>
                <li>
                    <h4>Mortgage Registration Fee (0.25% + AED 290)</h4>
                    <p><strong>Description:</strong> If a property is purchased with a mortgage, a registration fee of 0.25% of the mortgage value (plus a fixed fee of AED 290) is paid to the DLD. This is typically paid by the buyer.</p>
                    <p><strong>Managed by:</strong> Dubai Land Department (DLD)</p>
                </li>
                <li>
                    <h4>VAT (Value Added Tax)</h4>
                    <p><strong>Description:</strong> A 5% VAT applies to commercial property sales and leases. For residential properties, new residential properties are zero-rated for the first sale, while subsequent sales of residential properties are exempt from VAT. Real estate agent commissions are subject to 5% VAT.</p>
                    <p><strong>Managed by:</strong> Federal Tax Authority (FTA), collected by businesses.</p>
                </li>
                <li>
                    <h4>Service Charges / Community Fees</h4>
                    <p><strong>Description:</strong> These are annual fees paid by property owners to the master developer or Owners Association for the maintenance and management of common areas, facilities, and infrastructure within a community. These are not taxes but mandatory fees.</p>
                    <p><strong>Managed by:</strong> Master Developers / Owners Associations (regulated by RERA)</p>
                </li>
                <li>
                    <h4>No Annual Property Tax</h4>
                    <p><strong>Important Note:</strong> Unlike many other global cities, Dubai does not impose an annual property tax on owned real estate, which is a significant advantage for investors and homeowners.</p>
                </li>
            </ul>
            <p><strong>Overall Management of Taxes:</strong> Dubai Land Department (DLD) and Federal Tax Authority (FTA)</p>
        </div>

        <div class="home-section" id="rules-regs">
            <h3>Essential Rules and Regulations for Real Estate Agents in Dubai</h3>
            <p>Real estate agents in Dubai must adhere to strict regulations set by the Real Estate Regulatory Agency (RERA), a branch of the DLD, to ensure professionalism, transparency, and consumer protection. Key regulations include:</p>
            <ul>
                <li>
                    <h4>RERA Broker Card (License)</h4>
                    <p><strong>Requirement:</strong> All real estate agents must possess a valid RERA-issued broker card (license). This requires completing specific training courses (like the RERA-approved Real Estate Brokerage Course) and passing an exam.</p>
                    <p><strong>Managed by:</strong> RERA (Real Estate Regulatory Agency)</p>
                </li>
                <li>
                    <h4>Exclusive Listing Agreements (Form A)</h4>
                    <p><strong>Requirement:</strong> Agents must have a signed Form A (Seller's Agreement) with the property owner to market a property exclusively. Marketing without a valid Form A is illegal.</p>
                    <p><strong>Managed by:</b> RERA</p>
                </li>
                <li>
                    <h4>Advertising Regulations</h4>
                    <p><strong>Requirement:</strong> All property advertisements (online, print, billboards) must include a valid RERA permit number (e.g., "ORN" - Office Registration Number, and "BRN" - Broker Registration Number). Misleading advertising is strictly prohibited.</p>
                    <p><strong>Managed by:</strong> RERA</p>
                </li>
                <li>
                    <h4>Transparency and Disclosure</h4>
                    <p><strong>Requirement:</strong> Agents must disclose all relevant information about a property to potential buyers, including any known defects or encumbrances. They must act in the best interest of their clients.</p>
                    <p><strong>Managed by:</strong> RERA</p>
                </li>
                <li>
                    <h4>Trust Account Usage</h4>
                    <p><strong>Requirement:</strong> For off-plan properties, agents must ensure that buyer payments are directed to the developer's RERA-approved trust account, not directly to the developer or the agent's personal account.</p>
                    <p><strong>Managed by:</strong> RERA</p>
                </li>
                <li>
                    <h4>Anti-Money Laundering (AML) Compliance</h4>
                    <p><strong>Requirement:</strong> Agents are obligated to comply with UAE's AML laws, including conducting due diligence on clients and reporting suspicious transactions to the relevant authorities.</p>
                    <p><strong>Managed by:</strong> Financial Intelligence Department (FID) and RERA</p>
                </li>
                <li>
                    <h4>Code of Ethics</h4>
                    <p><strong>Requirement:</strong> Agents must adhere to a professional code of ethics, maintaining integrity, honesty, and fairness in all dealings.</p>
                    <p><strong>Managed by:</strong> RERA</p>
                </li>
            </ul>
            <p><strong>Overall Management of Agent Regulations:</strong> Real Estate Regulatory Agency (RERA)</p>
        </div>
    </div>

    <div class="page-container" id="highways-page">
        <h1>Dubai Main Roads Map</h1>
        <!-- Added a search bar to filter locations -->
        <input type="text" id="location-search" placeholder="Search communities or landmarks‚Ä¶" aria-label="Search locations‚Ä¶" oninput="filterLocations(event)">
        <div class="map">
            <div class="road" id="e11-road-section">
                <h2>E11 ‚Äì Sheikh Zayed Road</h2>
                <div class="dev-info">Developed by: Dubai Municipality | Managed by: RTA &amp; Nakheel</div>
                <div class="locations" id="e11-locations"></div>
            </div>
            <div class="road" id="e311-road-section">
                <h2>E311 ‚Äì Sheikh Mohammed Bin Zayed Road</h2>
                <div class="dev-info">Developed by: Dubai Municipality | Managed by: Dubai Properties &amp; Union Properties</div>
                <div class="locations" id="e311-locations"></div>
            </div>
            <div class="road" id="e611-road-section">
                <h2>E611 ‚Äì Emirates Road</h2>
                <div class="dev-info">Developed by: Dubai Municipality | Managed by: RTA &amp; Meydan</div>
                <div class="locations" id="e611-locations"></div>
            </div>
        </div>
    </div>

    <div class="info-panel" id="info-panel" aria-modal="true" role="dialog">
        <div class="panel-content">
            <button class="close" onclick="closePanel()" aria-label="Close">&times;</button>
            <div id="info-content"></div>
        </div>
    </div>

    <script>
        // ----- DYNAMIC DID YOU KNOW SNIPPETS -----
        const didYouKnowFacts = [
            "Did you know? <b>Dubai Land Department (DLD)</b> was founded in <b>1960</b> and registers all property transactions in the emirate!",
            "Dubai's <b>Palm Jumeirah</b> is visible from space and added 520km of coastline!",
            "No <b>annual property tax</b> is charged in Dubai‚Äîunique among major world cities.",
            "The Burj Khalifa is the tallest building on earth and is managed by Emaar.",
            "Dubai has <b>30+ master developers</b> and hundreds of communities.",
            "All tenancy contracts in Dubai must be registered in <b>Ejari</b> (DLD e-system).",
            "<b>Sheikh Zayed Road</b> (E11) is the UAE's longest road, running parallel to the coast.",
            "Dubai's master communities are often named after their main developer (e.g., Emaar, Nakheel).",
            "The <b>Dubai Metro</b> is the longest automated metro network in the world.",
            "Dubai is home to the <b>largest shopping mall</b> globally by total area, The Dubai Mall.",
            "The city's official language is Arabic, but English is widely spoken and understood.",
            "Dubai aims to be the <b>happiest city on Earth</b>, with initiatives like the Ministry of Happiness.",
            "The <b>Dubai Fountain</b> is the world's largest choreographed fountain system.",
            "Dubai's economy is highly diversified, with oil contributing less than 5% to its GDP.",
            "The <b>Dubai Gold Souk</b> is one of the oldest and largest traditional markets in Dubai.",
            "Dubai hosts the annual <b>Dubai Shopping Festival</b>, attracting millions of tourists.",
            "The city has a <b>zero income tax policy</b> for individuals, making it attractive for professionals.",
            "Dubai has one of the lowest crime rates in the world, making it a very safe city.",
            "The <b>Dubai Frame</b> offers panoramic views of old and new Dubai.",
            "Dubai's police force uses luxury cars like Lamborghinis and Ferraris.",
            "The city is building <b>Mohammed Bin Rashid City</b>, which will include the world's largest man-made lagoon.",
            "Dubai is a major global hub for gold trading.",
            "The <b>Dubai Miracle Garden</b> is the world's largest natural flower garden.",
            "Dubai has a <b>Ministry of Tolerance</b> to promote coexistence and peace.",
            "The <b>Global Village</b> in Dubai is a multicultural festival park.",
            "Dubai's population is made up of over 200 nationalities.",
            "The city is home to the world's first <b>7-star hotel</b>, the Burj Al Arab.",
            "Dubai is a leading destination for luxury tourism and shopping.",
            "The <b>Dubai Desert Conservation Reserve</b> is a protected area for native wildlife.",
            "Dubai has ambitious plans for a <b>Hyperloop</b> system.",
            "The city is a pioneer in smart city initiatives and technology adoption.",
            "Dubai's public transportation system is highly advanced and efficient.",
            "The <b>Dubai Opera</b> is a multi-format performing arts center.",
            "Dubai has a vibrant arts and culture scene, with numerous galleries and museums.",
            "The city is a major global center for Islamic finance.",
            "Dubai hosts the <b>Dubai World Cup</b>, one of the world's richest horse races.",
            "The <b>Jumeirah Mosque</b> is one of the few mosques in Dubai open to non-Muslims.",
            "Dubai has a strong focus on sustainability and green initiatives.",
            "The city is home to numerous world-class educational institutions.",
            "Dubai's healthcare system is modern and offers high-quality services.",
            "The <b>Dubai Creek</b> is a natural saltwater creek that divides the city into two main sections.",
            "Dubai is a major re-export hub for goods to the Middle East, Africa, and Asia.",
            "The city has a very high quality of life, attracting expats from around the globe.",
            "Dubai is constantly innovating and building new record-breaking attractions.",
            "The <b>Dubai Future Foundation</b> drives innovation and future foresight.",
            "Dubai has a diverse culinary scene, from street food to Michelin-starred restaurants.",
            "The city is known for its spectacular New Year's Eve fireworks displays.",
            "Dubai is a popular destination for MICE (Meetings, Incentives, Conferences, and Exhibitions) tourism.",
            "The <b>Al Fahidi Historical Neighbourhood</b> offers a glimpse into old Dubai.",
            "Dubai has a strategic location, connecting East and West.",
            "The city is a hub for international trade and commerce.",
            "Dubai has invested heavily in infrastructure to support its growth.",
            "The <b>Dubai Design District (d3)</b> is a hub for fashion, art, and design.",
            "Dubai has a strong focus on renewable energy, including solar power.",
            "The city offers a wide range of outdoor activities, from desert safaris to water sports.",
            "Dubai's vision is to be the smartest and most sustainable city in the world.",
            "The <b>Museum of the Future</b> showcases innovative and futuristic concepts.",
            "Dubai has a thriving startup ecosystem and supports entrepreneurship.",
            "The city is a popular destination for medical tourism.",
            "Dubai has a strong commitment to digital transformation.",
            "The <b>Dubai Safari Park</b> is home to thousands of animals from around the world.",
            "Dubai's government is known for its efficiency and pro-business policies.",
            "The city offers a tax-free environment for businesses in many free zones.",
            "Dubai has a diverse range of residential options, from luxury villas to affordable apartments.",
            "The <b>Dubai Canal</b> has transformed parts of the city into a waterfront destination.",
            "Dubai is a safe and welcoming city for families.",
            "The city has a strong focus on creating green spaces and parks.",
            "Dubai is a global leader in tourism and hospitality.",
            "The <b>IMG Worlds of Adventure</b> is one of the world's largest indoor theme parks.",
            "Dubai has a rich history and cultural heritage.",
            "The city is a melting pot of cultures and traditions.",
            "Dubai's infrastructure includes world-class roads, bridges, and tunnels.",
            "The <b>Dubai World Trade Centre</b> is a major exhibition and convention venue.",
            "Dubai is constantly expanding its public transport network.",
            "The city has a strong focus on education and human capital development.",
            "Dubai offers a high standard of living with excellent amenities.",
            "The <b>Hatta Dam</b> offers stunning natural beauty and outdoor activities.",
            "Dubai is a popular destination for international events and festivals.",
            "The city has a strong commitment to environmental protection.",
            "Dubai's real estate market is known for its resilience and growth.",
            "The <b>Dubai Creek Tower</b> is planned to be even taller than the Burj Khalifa.",
            "Dubai is a hub for global talent and innovation.",
            "The city has a strong focus on research and development.",
            "Dubai offers a wide range of leisure and entertainment options.",
            "The <b>Dubai Water Canal Cruise</b> offers unique city views.",
            "Dubai is a city of superlatives, constantly breaking world records.",
            "The <b>Expo City Dubai</b> is a sustainable city built on the legacy of Expo 2020.",
            "Dubai has a strategic location for international business and trade.",
            "The city is known for its futuristic architecture and urban planning.",
            "Dubai has a strong focus on creating smart and happy communities.",
            "The <b>Dubai Parks and Resorts</b> features multiple theme parks.",
            "Dubai is a leading destination for luxury shopping and fashion.",
            "The city has a diverse range of culinary experiences.",
            "Dubai's commitment to safety and security is paramount.",
            "The <b>Al Qudra Lakes</b> are a popular spot for outdoor recreation and wildlife.",
            "Dubai is a hub for international sporting events.",
            "The city has a strong focus on promoting health and well-being.",
            "Dubai's government is highly proactive in its development plans.",
            "The <b>Dubai International Financial Centre (DIFC)</b> is a leading financial hub.",
            "Dubai offers a wide range of educational choices, from nurseries to universities.",
            "The city has a strong focus on digital literacy and innovation.",
            "Dubai is known for its beautiful beaches and waterfronts.",
            "The <b>City Walk</b> is a popular outdoor retail and dining destination.",
            "Dubai is a global leader in urban development and infrastructure.",
            "The city has a strong commitment to cultural preservation.",
            "Dubai offers a unique blend of tradition and modernity.",
            "The <b>Dubai Aquarium & Underwater Zoo</b> is home to thousands of aquatic animals.",
            "Dubai is a popular destination for adventure tourism.",
            "The city has a strong focus on smart mobility solutions.",
            "Dubai's real estate market offers diverse investment opportunities.",
            "The <b>Dubai Hills Estate</b> is a luxurious golf course community.",
            "Dubai is a hub for international talent and expertise.",
            "The city has a strong focus on sustainable urban development.",
            "Dubai offers a vibrant nightlife and entertainment scene.",
            "The <b>Global Village</b> attracts millions of visitors annually.",
            "Dubai is known for its world-class hospitality and service.",
            "The city has a strong commitment to innovation and future readiness.",
            "Dubai's government actively encourages foreign investment.",
            "The <b>Dubai Marina Mall</b> is a popular shopping destination.",
            "Dubai is a city where dreams are built and realized."
        ];
        function randomDidYouKnow() {
            document.getElementById('didYouKnowText').innerHTML =
                didYouKnowFacts[Math.floor(Math.random() * didYouKnowFacts.length)];
        }
        // Show a new random "Did you know?" fact on each home page show
        document.addEventListener('DOMContentLoaded', function() {
            randomDidYouKnow();
        });

        // ----- SMOOTH SCROLL TO HOME SECTIONS -----
        function scrollToSection(sectionId) {
            const sec = document.getElementById(sectionId);
            if(sec) sec.scrollIntoView({behavior:'smooth', block:'start'});
        }

        // ----- BACK TO TOP BUTTON -----
        const backToTopBtn = document.getElementById('back-to-top');
        function displayBackToTop() {
            // Check the scroll position of the main window/document
            if(window.scrollY > 275) {
                backToTopBtn.style.display = "block";
            } else {
                backToTopBtn.style.display = "none";
            }
        }
        // Listen for scroll events on the window/document
        window.addEventListener('scroll', displayBackToTop);
        backToTopBtn.addEventListener('click', function(){
            window.scrollTo({top:0, behavior:'smooth'});
        });

        // ----- YOUR EXISTING JS DATA -----
        const locationsData = {
            e11: [
                { id: "jebel-ali-free-zone", name: "Jebel Ali Free Zone (JAFZA)", developer: "DP World", manager: "DP World (Jafza)", famousFor: "One of the world's largest free zones, a global industrial and logistics hub." },
                { id: "palm-jebel-ali", name: "Palm Jebel Ali", developer: "Nakheel Properties", manager: "Nakheel Properties", famousFor: "An upcoming iconic palm-shaped island development, currently undergoing redevelopment." },
                { id: "jebel-ali-port", name: "Jebel Ali Port", developer: "DP World", manager: "DP World", famousFor: "The largest man-made harbor in the world and the busiest port in the Middle East." },
                { id: "ibn-battuta", name: "Ibn Battuta Mall", developer: "Nakheel Properties", manager: "Nakheel Properties", famousFor: "A themed shopping mall inspired by the travels of explorer Ibn Battuta, known for its unique architecture." },
                { id: "jumeirah-lake-towers-jlt", name: "Jumeirah Lake Towers (JLT)", developer: "DMCC (Dubai Multi Commodities Centre)", manager: "DMCC and various property management companies.", famousFor: "A vibrant mixed-use high-rise community built around artificial lakes, popular for residential and commercial spaces." },
                { id: "dubai-marina", name: "Dubai Marina", developer: "Emaar Properties", manager: "Emaar Properties and various community management associations.", famousFor: "A premium waterfront living destination with skyscrapers, luxury yachts, and a bustling promenade." },
                { id: "bluewaters-island", name: "Bluewaters Island", developer: "Meraas (now Dubai Holding)", manager: "Dubai Holding", famousFor: "Home to Ain Dubai (the world's largest observation wheel) and luxury beachfront residences, dining, and entertainment." },
                { id: "jbr", name: "Jumeirah Beach Residence (JBR)", developer: "Dubai Properties", manager: "Dubai Properties and various community management associations.", famousFor: "A popular beachfront residential and leisure destination with a vibrant walk, restaurants, and retail." },
                { id: "princess-tower", name: "Princess Tower", developer: "Tameer Holding Investment", manager: "Various property management companies.", famousFor: "Once the world's tallest residential building, offering panoramic views of Dubai Marina and Palm Jumeirah." },
                { id: "dubai-harbour", name: "Dubai Harbour", developer: "Meraas (now Dubai Holding)", manager: "Dubai Holding", famousFor: "A new waterfront destination featuring a state-of-art cruise terminal, luxury residences, and a large marina." },
                { id: "emaar-beachfront", name: "Emaar Beachfront", developer: "Emaar Properties", manager: "Emaar Properties", famousFor: "An exclusive residential community offering luxury apartments with direct beach access and stunning views of the Arabian Gulf." },
                { id: "dubai-media-city", name: "Dubai Media City", developer: "TECOM Group (part of Dubai Holding)", manager: "TECOM Group", famousFor: "A free zone dedicated to media and advertising companies, a hub for regional and international media organizations." },
                { id: "dubai-internet-city", name: "Dubai Internet City", developer: "TECOM Group (part of Dubai Holding)", manager: "TECOM Group", famousFor: "The Middle East's largest information and communications technology (ICT) free zone, home to global tech giants." },
                { id: "dubai-knowledge-park", name: "Dubai Knowledge Park", developer: "TECOM Group (part of Dubai Holding)", manager: "TECOM Group", famousFor: "A free zone dedicated to human resource management, learning, and educational institutions." },
                { id: "palm-jumeirah", name: "Palm Jumeirah", developer: "Nakheel Properties", manager: "Nakheel Properties and various community management associations.", famousFor: "An iconic man-made archipelago, famous for its luxury villas, hotels (like Atlantis), and high-end lifestyle." },
                { id: "flamingos-villas", name: "Flamingos Villas", developer: "R Holdings", manager: "R Holdings and community management.", famousFor: "A residential villa community within Jumeirah Village Circle/Triangle area." },
                { id: "al-nakheel-villas", name: "Al Nakheel Villas", developer: "Nakheel Properties", manager: "Nakheel Properties and community management.", famousFor: "A residential community with villas, often associated with Nakheel developments." },
                { id: "al-safouh", name: "Al Safouh", developer: "Various developers", manager: "Dubai Municipality / Individual property owners", famousFor: "A coastal area with residential and commercial properties, close to major attractions and the beach." },
                { id: "mall-of-emirates", name: "Mall of the Emirates", developer: "Majid Al Futtaim Properties", manager: "Majid Al Futtaim Properties", famousFor: "A world-renowned shopping mall, famous for Ski Dubai (indoor ski resort) and luxury brands." },
                { id: "umm-al-sheif", name: "Umm Al Sheif", developer: "Dubai Municipality", manager: "Dubai Municipality", famousFor: "A quiet residential area known for its large villas and proximity to Jumeirah and Al Barsha." },
                { id: "umm-suqeim-3", name: "Umm Suqeim 3", developer: "Dubai Municipality", manager: "Dubai Municipality", famousFor: "A residential area known for its beach access, proximity to Burj Al Arab, and family-friendly environment." },
                { id: "burj-al-arab", name: "Burj Al Arab", developer: "Jumeirah Group", manager: "Jumeirah Group", famousFor: "An iconic sail-shaped luxury hotel, often referred to as a '7-star' hotel, a symbol of Dubai." },
                { id: "umm-suqeim-2", name: "Umm Suqeim 2", developer: "Dubai Municipality", manager: "Dubai Municipality", famousFor: "Another residential area within Umm Suqeim, known for its villas and proximity to Kite Beach." },
                { id: "al-safa-2", name: "Al Safa 2", developer: "Dubai Municipality", manager: "Dubai Municipality", famousFor: "A residential community with villas, offering good connectivity and proximity to Safa Park." },
                { id: "umm-suqeim-1", name: "Umm Suqeim 1", developer: "Dubai Municipality", manager: "Dubai Municipality", famousFor: "The oldest part of Umm Suqeim, known for its traditional villas and direct beach access." },
                { id: "al-safa", name: "Al Safa", developer: "Dubai Municipality", manager: "Dubai Municipality", famousFor: "A well-established residential area with villas and apartments, known for Safa Park and its central location." },
                { id: "jumeirah-3", name: "Jumeirah 3", developer: "Dubai Municipality", manager: "Dubai Municipality", famousFor: "A prime residential area with villas, offering beach access and a relaxed lifestyle." },
                { id: "safa-park", name: "Safa Park", developer: "Dubai Municipal Corporation", manager: "Dubai Municipal Corporation", famousFor: "A large urban park, popular for recreation, picnics, and its green spaces." },
                { id: "sunset-mall", name: "Sunset Mall", developer: "Wasl Properties", manager: "Wasl Properties", famousFor: "A community mall in Jumeirah, offering retail, dining, and entertainment options." },
                { id: "the-world-island", name: "The World Island", developer: "Nakheel", manager: "Kleindienst Group (for The Heart of Europe)", famousFor: "An artificial archipelago of small islands constructed in the shape of a world map, with some islands developed into luxury resorts." },
                { id: "the-private-island-sweden", name: "The Private Island (Sweden Island)", developer: "The Kleindienst Group", manager: "The Kleindienst Group", famousFor: "Part of The Heart of Europe development on The World Islands, offering luxury villas with unique designs." },
                { id: "dubai-canal", name: "Dubai Canal", developer: "RTA (Roads and Transport Authority)", manager: "RTA", famousFor: "An artificial waterway extending from Business Bay to the Arabian Gulf, transforming parts of Dubai into a waterfront city." },
                { id: "al-wasl", name: "Al Wasl", developer: "Wasl Properties", manager: "Wasl Properties", famousFor: "A residential area known for its villas, schools, and proximity to Jumeirah and Sheikh Zayed Road." },
                { id: "jumeirah-2", name: "Jumeirah 2", developer: "Wasl Properties", manager: "Wasl Properties", famousFor: "A residential area with villas, offering beach access and a mix of traditional and modern properties." },
                { id: "jumeirah-bay-islands", name: "Jumeirah Bay Islands", developer: "Meraas (now Dubai Holding)", manager: "Dubai Holding", famousFor: "A luxury island destination featuring Bulgari Resort & Residences and high-end properties." },
                { id: "bulgan-island", name: "Bulgari Island", developer: "Meraas (now Dubai Holding)", manager: "Dubai Holding", famousFor: "Home to the ultra-luxury Bulgari Resort & Residences, part of Jumeirah Bay Islands." },
                { id: "al-satwa", name: "Al Satwa", developer: "Wasl Properties (some parts by Dubai Municipality)", manager: "Wasl Properties / Dubai Municipality", famousFor: "A vibrant, multicultural residential and commercial area known for its diverse shops, tailors, and restaurants." },
                { id: "al-badaa", name: "Al Bada'a", developer: "Dubai Municipality", manager: "Dubai Municipality", famousFor: "A residential area located between Jumeirah and Al Satwa, offering a mix of villas and apartments." },
                { id: "jumeirah-1", name: "Jumeirah 1", developer: "Wasl Properties", manager: "Wasl Properties", famousFor: "The original Jumeirah district, known for its traditional villas, beach access, and proximity to La Mer." },
                { id: "la-mer", name: "La Mer", developer: "Meraas (now Dubai Holding)", manager: "Dubai Holding", famousFor: "A popular beachfront destination with trendy restaurants, cafes, retail, and recreational facilities." },
                { id: "al-jaffiliya", name: "Al Jaffiliya", developer: "Dubai Municipality", manager: "Dubai Municipality", famousFor: "A residential and administrative area, home to the General Directorate of Residency and Foreigners Affairs (GDRFA)." },
                { id: "al-hudaiba", name: "Al Hudaiba", developer: "Dubai Municipality", manager: "Dubai Municipality", famousFor: "A residential area located near Port Rashid and the coast, offering a mix of villas and apartments." },
                { id: "al-mina", name: "Al Mina", developer: "DP World", manager: "DP World (Ports, Customs & Free Zone Corporation)", famousFor: "A significant port area in Dubai, crucial for maritime trade and logistics, part of the larger port operations." },
                { id: "dubai-dry-docks", name: "Dubai Dry Docks", developer: "DP World", manager: "DP World", famousFor: "One of the largest ship repair yards in the Middle East, offering comprehensive maritime services." },
                { id: "zabeel-park", name: "Zabeel Park", developer: "Dubai Municipality", manager: "Dubai Municipality", famousFor: "A large public park in Dubai, known for its green spaces, jogging tracks, and the iconic Dubai Frame." },
                { id: "umm-hurair-2", name: "Umm Hurair 2", developer: "Tatweer / Dubai Holding", manager: "Tatweer / Dubai Holding", famousFor: "A mixed-use area, home to Dubai Healthcare City and various residential and commercial developments." },
                { id: "mohammed-bin-rashid-university", name: "Mohammed Bin Rashid University of Medicine and Health Sciences (MBRU)", developer: "DHCA (Dubai Healthcare City Authority)", manager: "DHCA", famousFor: "A leading academic institution focusing on health sciences education and research." },
                { id: "sofitel-dubai", name: "Sofitel Dubai Downtown", developer: "Wafi Group (MKM Holding)", manager: "Wafi Group (MKM Holding)", famousFor: "A luxury hotel offering direct access to The Dubai Mall and stunning views of Burj Khalifa." },
                { id: "wafi-mall", name: "Wafi Mall", developer: "Wafi Group (MKM Holding)", manager: "Wafi Group (MKM Holding)", famousFor: "A distinctive shopping mall with an Egyptian theme, known for its unique architecture and luxury boutiques." },
                { id: "oud-metha", name: "Oud Metha", developer: "Dubai Municipality", manager: "Dubai Municipality", famousFor: "A well-established residential and commercial area known for its schools, hospitals, and a mix of apartments and villas." },
                { id: "al-karama", name: "Al Karama", developer: "Dubai Municipality", manager: "Dubai Municipality", famousFor: "A bustling residential and commercial district popular for its affordable housing, diverse dining options, and numerous shops." },
                { id: "al-mankhool", name: "Al Mankhool", developer: "Dubai Municipality", manager: "Dubai Municipality / Individual property owners", famousFor: "A residential area in Bur Dubai, known for its apartments, hotels, and proximity to shopping malls and historical sites." },
                { id: "bur-juman", name: "BurJuman", developer: "Al Ghurair Group", manager: "Al Ghurair Group", famousFor: "One of Dubai's oldest shopping malls, known for its luxury brands and family-friendly atmosphere." },
                { id: "al-raffa", name: "Al Raffa", developer: "Dubai Municipality", manager: "Dubai Municipality", famousFor: "A residential and commercial area in Bur Dubai, known for its mix of apartments, shops, and restaurants." },
                { id: "extension-of-al-mina", name: "Extension of Al Mina", developer: "DP World", manager: "DP World", famousFor: "An expansion of the Al Mina port area, enhancing its capabilities for cargo and logistics." },
                { id: "dubai-customs", name: "Dubai Customs", developer: "Government of Dubai", manager: "Government of Dubai", famousFor: "The government authority responsible for customs operations, trade facilitation, and border security." },
                { id: "port-rashid-passenger-terminal", name: "Port Rashid Passenger Terminal", developer: "DP World", manager: "DP World", famousFor: "A major cruise terminal serving international cruise lines and passengers visiting Dubai." },
                { id: "port-rashid", name: "Port Rashid", developer: "Dubai Government (1970), later Nakheel with EMAAR & DP World", manager: "DP World", famousFor: "A historic commercial port now being redeveloped into a cruise tourism destination and waterfront community." },
                { id: "dubai-maritime-city", name: "Dubai Maritime City", developer: "Dubai Maritime City LLC (a subsidiary of DP World)", manager: "Dubai Maritime City LLC", famousFor: "A purpose-built maritime hub designed to support the maritime industry, offering commercial and industrial facilities." },
                { id: "deira", name: "Deira", developer: "Dubai Municipality", manager: "Dubai Municipality (some areas by Wasl Group)", famousFor: "The historic heart of Dubai, known for its traditional souks (gold, spice, perfume), Dhow Wharfage, and vibrant trading." },
                { id: "dubai-islands", name: "Dubai Islands", developer: "Nakheel", manager: "Nakheel", famousFor: "A new waterfront masterplan by Nakheel, transforming the former Deira Islands into a prime residential and tourism destination." },
                { id: "al-qusais", name: "Al Qusais", developer: "Dubai Municipality", manager: "Dubai Municipality", famousFor: "A large residential and industrial area, known for its affordable housing and proximity to Dubai International Airport." },
                { id: "dubai-international-airport", name: "Dubai International Airport (DXB)", developer: "Dubai Airports", manager: "Dubai Airports", famousFor: "One of the world's busiest airports by international passenger traffic, a major global aviation hub." },
                { id: "al-twar", name: "Al Twar", developer: "Dubai Municipality", manager: "Dubai Municipality", famousFor: "A well-established residential area with villas, known for its quiet environment and family-friendly amenities." },
                { id: "al-nahda", name: "Al Nahda", developer: "Dubai Municipality", manager: "Dubai Municipality", famousFor: "A residential area bordering Sharjah, offering affordable housing options and good connectivity." },
                { id: "towards-sharjah-e11", name: "Towards Sharjah", developer: "RTA", manager: "RTA", famousFor: "The continuation of E11 leading towards the emirate of Sharjah." }
            ],
            e311: [
                { id: "jebel-ali-industrial-e311", name: "Jebel Ali Industrial", name: "Jebel Ali Industrial", developer: "Various developers", manager: "Various entities", famousFor: "Manufacturing & warehouse hub along E311." },
                { id: "dip", name: "DIP (Dubai Investments Park)", developer: "Dubai Investments", manager: "Dubai Investments", famousFor: "A mixed-use development with industrial, commercial, and residential zones." },
                { id: "dubai-production-city", name: "Dubai Production City (IMPZ)", developer: "TECOM Group", manager: "TECOM Group", famousFor: "A free zone dedicated to media production and printing industries." },
                { id: "dubai-sports-city", name: "Dubai Sports City", developer: "Dubai Properties", manager: "Dubai Properties and community management.", famousFor: "A multi-venue sports complex with residential and commercial properties." },
                { id: "jumeirah-village-circle-jvc", name: "Jumeirah Village Circle (JVC)", developer: "Nakheel Properties", manager: "Various property management companies and community associations.", famousFor: "A family-friendly master community known for its affordable villas, townhouses, and apartments." },
                { id: "jumeirah-village-triangle-jvt", name: "Jumeirah Village Triangle (JVT)", developer: "Nakheel Properties", manager: "Various property management companies.", famousFor: "A residential community similar to JVC, offering villas and townhouses, known for its quiet environment." },
                { id: "motor-city", name: "Motor City", developer: "Union Properties", manager: "Union Properties and community management.", famousFor: "A motorsport-themed development offering residential properties, business parks, and retail outlets." },
                { id: "arabian-ranches", name: "Arabian Ranches", developer: "Emaar Properties", manager: "Emaar Properties and community management.", famousFor: "A prestigious desert-themed gated villa community, known for its golf course and equestrian facilities." },
                { id: "dubai-silicon-oasis-e311", name: "Dubai Silicon Oasis", developer: "Dubai Silicon Oasis Authority (DSOA)", manager: "DSOA", famousFor: "A free zone technology park with residential and commercial properties, fostering innovation and technology." },
                { id: "academic-city-e311", name: "Academic City", developer: "TECOM Group", manager: "TECOM Group", famousFor: "A large educational hub hosting numerous universities and colleges." },
                { id: "mirdif", name: "Mirdif", developer: "Dubai Municipality", manager: "Dubai Municipality", famousFor: "A popular residential area known for its family-friendly environment, villas, and Mirdif City Centre." },
                { id: "al-warqaa", name: "Al Warqaa", developer: "Dubai Municipality", manager: "Dubai Municipality", famousFor: "A residential suburb with large villas and a focus on community living." },
                { id: "muhaisnah", name: "Muhaisnah", developer: "Dubai Municipality", manager: "Dubai Municipality", famousFor: "A mixed-use area near the Sharjah border, with residential and labor accommodation." },
                { id: "al-qusais-industrial-e311", name: "Al Qusais Industrial", developer: "Dubai Municipality", manager: "Dubai Municipality", famousFor: "Industrial estates and workshops area." },
                { id: "towards-sharjah-e311", name: "Towards Sharjah", developer: "RTA", manager: "RTA", famousFor: "The continuation of E311 leading towards the emirate of Sharjah." }
            ],
            e611: [
                { id: "jebel-ali-e611", name: "Jebel Ali", developer: "DP World", manager: "DP World", famousFor: "Logistics, industrial & port access point from E611." },
                { id: "dubai-industrial-city", name: "Dubai Industrial City", developer: "Dubai Holding", manager: "Dubai Holding", famousFor: "A large manufacturing and logistics hub, home to various industrial sectors." },
                { id: "dubai-south", name: "Dubai South", developer: "Dubai Aviation City Corporation", manager: "Dubai Aviation City Corporation", famousFor: "A master-planned city encompassing Al Maktoum International Airport and the Expo 2020 site." },
                { id: "al-maktoum-international-airport", name: "Al Maktoum International Airport (DWC)", developer: "Dubai Aviation City Corporation", manager: "Dubai Aviation City Corporation", famousFor: "Dubai's second international airport, a key component of Dubai South's logistics and aviation hub." },
                { id: "dubai-logistics-city", name: "Dubai Logistics City", developer: "Dubai Aviation City Corporation", manager: "Dubai Aviation City Corporation", famousFor: "A free zone dedicated to logistics, freight, and supply chain management within Dubai South." },
                { id: "expo-city-dubai", name: "Expo City Dubai", developer: "Dubai Government", manager: "Expo City Dubai Authority", famousFor: "The legacy site of Expo 2020 Dubai, now a futuristic, sustainable city with business, residential, and attractions." },
                { id: "dubailand", name: "Dubailand", developer: "Dubai Properties", manager: "Dubai Properties and various developers.", famousFor: "A massive entertainment and residential development, home to various theme parks and communities." },
                { id: "the-villa", name: "The Villa", developer: "Dubai Properties", manager: "Dubai Properties and community management.", famousFor: "An upscale Spanish-style villa community within Dubailand." },
                { id: "falcon-city", name: "Falcon City of Wonders", developer: "Falconcity of Wonders LLC", manager: "Falconcity of Wonders LLC", famousFor: "A unique residential project featuring replicas of world-famous monuments." },
                { id: "al-barari", name: "Al Barari", developer: "Sustainable City Development", manager: "Sustainable City Development", famousFor: "A luxurious eco-friendly residential community known for its lush green spaces and tranquil environment." },
                { id: "al-aweer", name: "Al Aweer", developer: "Dubai Municipality", manager: "Dubai Municipality", famousFor: "Known for its central fruit and vegetable market, and a mix of residential and agricultural areas." },
                { id: "ras-al-khor", name: "Ras Al Khor", developer: "Dubai Municipality", manager: "Dubai Municipality", famousFor: "Home to the Ras Al Khor Wildlife Sanctuary (flamingos) and an industrial area." },
                { id: "international-city", name: "International City", developer: "Nakheel Properties", manager: "Nakheel Properties", famousFor: "An affordable residential development with country-themed clusters and Dragon Mart." },
                { id: "dragon-mart", name: "Dragon Mart", developer: "Nakheel Properties", manager: "Nakheel Properties", famousFor: "The largest trading hub for Chinese products outside mainland China." },
                { id: "silicon-oasis-e611", name: "Silicon Oasis", developer: "Dubai Silicon Oasis Authority (DSOA)", manager: "DSOA", famousFor: "A free zone technology park with residential and commercial properties, fostering innovation and technology." },
                { id: "academic-city-e611", name: "Academic City", developer: "TECOM Group", manager: "TECOM Group", famousFor: "A large educational hub hosting numerous universities and colleges." },
                { id: "warsan", name: "Warsan", developer: "Dubai Municipality", manager: "Dubai Municipality", famousFor: "An emerging residential area, home to the Warsan wastewater treatment plant and various developments." },
                { id: "towards-sharjah-e611", name: "Towards Sharjah", developer: "RTA", manager: "RTA", famousFor: "The continuation of E611 leading towards the emirate of Sharjah." }
            ]
        };

        let currentPageId = '';

        // --- ROAD SEARCH ---
        function filterLocations(event) {
            let query = event.target.value.toLowerCase();
            document.querySelectorAll('.road').forEach(roadEl => {
                const roadKey = roadEl.id.replace('-road-section', '');
                const locations = locationsData[roadKey] || [];
                const matches = locations.some(loc =>
                    loc.name.toLowerCase().includes(query)
                );
                roadEl.style.display = (query === "" || matches) ? "" : "none";
            });
        }

        // --- PAGE NAVIGATION ---
        function showPage(pageId) {
            document.querySelectorAll('.page-container').forEach(page => {
                page.classList.remove('active-page');
            });
            const activePage = document.getElementById(pageId);
            if (activePage) {
                activePage.classList.add('active-page');
                currentPageId = pageId;
                if (pageId === 'home-page') randomDidYouKnow(); // Refresh "Did you know?" on home page
                if (pageId !== 'highways-page') {
                    document.querySelectorAll('.locations.is-visible').forEach(openLocations => {
                        if (openLocations.id !== locationsContainer.id) {
                            openLocations.classList.remove('is-visible');
                            openLocations.innerHTML = '';
                        }
                    }); // Corrected: closing brace for the if statement
                }
            }
            closePanel(); // Close info panel when changing pages
            window.scrollTo({top:0, behavior:'smooth'}); // Scroll to top of the new page
        }

        // --- LOCATIONS CREATION ---
        function createLocations(roadId, data) {
            const container = document.getElementById(`${roadId}-locations`);
            container.innerHTML = '';
            data.forEach((loc, index) => {
                const div = document.createElement("div");
                div.className = "location";
                div.textContent = `${index + 1}. ${loc.name}`;
                div.setAttribute('tabindex', 0); // Make locations focusable
                div.onclick = function(event) {
                    event.stopPropagation();
                    showInfo(loc, div);
                };
                container.appendChild(div);
            });
        }

        // --- SHOW INFO PANEL ---
        function showInfo(location, element) {
            const infoPanel = document.getElementById("info-panel");
            const infoContent = document.getElementById("info-content");
            const activePageElement = document.getElementById(currentPageId);

            document.querySelectorAll(".location").forEach(el => el.classList.remove("active"));
            element.classList.add("active");

            // Optional: Use Unsplash (location-based) image as a placeholder
            const photoSrc = `https://source.unsplash.com/600x120/?dubai,building,${encodeURIComponent(location.name)}`;

            infoContent.innerHTML = `
                <h2>${location.name}</h2>
                <img src="${photoSrc}" alt="Photo of ${location.name}" class="location-thumb" onerror="this.style.display='none'">
                <div class="info-icons"><span>üè¢</span> <b>Developer:</b></div>
                <p>${location.developer}</p>
                <div class="info-icons"><span>üë®‚Äçüíº</span> <b>Manager:</b></div>
                <p>${location.manager}</p>
                <div class="info-icons"><span>üåü</span> <b>Why It's Famous:</b></div>
                <p>${location.famousFor}</p>
                <button class="generate-insights-btn" onclick="getInvestmentInsights(${JSON.stringify(location).replace(/"/g, '&quot;')})">‚ú® Get Investment Insights</button>
                <div id="ai-insights-output" class="ai-insights-section" style="display:none;">
                    <h3>AI Investment Insights:</h3>
                    <p id="ai-insights-text"></p>
                </div>
            `;

            infoPanel.classList.add("active");
            if (activePageElement) activePageElement.classList.add("blurred-content");
        }

        async function getInvestmentInsights(location) {
            const insightsOutputDiv = document.getElementById('ai-insights-output');
            const insightsTextP = document.getElementById('ai-insights-text');
            const generateButton = document.querySelector('.generate-insights-btn');

            insightsOutputDiv.style.display = 'block';
            insightsTextP.innerHTML = '<span class="loading-message">Generating insights...</span>';
            generateButton.disabled = true; // Disable button during generation

            const prompt = `Based on the following information about a Dubai location, provide a concise summary of its real estate investment potential, highlighting key aspects that would attract investors or residents. Focus on its famous features, developer, and manager.
Location: ${location.name}
Developer: ${location.developer}
Manager: ${location.manager}
Famous For: ${location.famousFor}
Keep the response to 3-4 sentences.`;

            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });

            const payload = { contents: chatHistory };
            const apiKey = ""; // Canvas will provide this API key at runtime
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    insightsTextP.textContent = text;
                } else {
                    insightsTextP.textContent = "Could not generate insights. Please try again.";
                    console.error("Gemini API response structure unexpected:", result);
                }
            } catch (error) {
                insightsTextP.textContent = "Error generating insights. Please check your connection or try again later.";
                console.error("Error calling Gemini API:", error);
            } finally {
                generateButton.disabled = false; // Re-enable the button
            }
        }

        function closePanel() {
            const infoPanel = document.getElementById("info-panel");
            const activePageElement = document.getElementById(currentPageId);
            infoPanel.classList.remove("active");
            if (activePageElement) activePageElement.classList.remove("blurred-content");
            document.querySelectorAll(".location").forEach(el => el.classList.remove("active"));

            // Hide AI insights section when closing panel
            const insightsOutputDiv = document.getElementById('ai-insights-output');
            if (insightsOutputDiv) {
                insightsOutputDiv.style.display = 'none';
                document.getElementById('ai-insights-text').textContent = ''; // Clear previous insights
            }
        }

        // Event listener to close panel when clicking outside of panel-content
        document.addEventListener('click', (event) => {
            const infoPanel = document.getElementById("info-panel");
            const panelContent = infoPanel.querySelector('.panel-content');
            const clickedElement = event.target;
            if (infoPanel.classList.contains('active') &&
                !panelContent.contains(clickedElement) &&
                !clickedElement.classList.contains('close') &&
                !clickedElement.closest('.road') &&
                !clickedElement.classList.contains('nav-button') &&
                !clickedElement.classList.contains('generate-insights-btn')) { // Exclude insights button
                closePanel();
            }
        });

        // --- ROAD SECTION TOGGLE ---
        document.querySelectorAll('.road').forEach(roadElement => {
            roadElement.addEventListener('click', (event) => {
                if (event.target.classList.contains('location')) return;
                const roadId = roadElement.id;
                const roadKey = roadId.replace('-road-section', '');
                const locationsContainer = document.getElementById(`${roadKey}-locations`);
                document.querySelectorAll('.locations.is-visible').forEach(openLocations => {
                    if (openLocations.id !== locationsContainer.id) {
                        openLocations.classList.remove('is-visible');
                        openLocations.innerHTML = '';
                    }
                }); // Corrected: closing brace for the if statement
                if (locationsContainer.classList.contains('is-visible')) {
                    locationsContainer.classList.remove('is-visible');
                    locationsContainer.innerHTML = '';
                } else {
                    createLocations(roadKey, locationsData[roadKey]);
                    locationsContainer.classList.add('is-visible');
                }
            });
        });

        // --- INITIAL LOAD ---
        document.addEventListener('DOMContentLoaded', () => {
            showPage('home-page');
        });
    </script>
</body>
</html>
